clear 
clc 
%% Read in images
dir = fullfile('/Users/marissadalonzo/Documents/MATLAB/ComputerVision/Lab4/DanaHallWay2');
files = imageDatastore(dir);
image1 = rgb2gray(readimage(files,1)); 
image2 = rgb2gray(readimage(files,2)); 

%% Harris detector 
% Calculate gradient masks 
[Ix,Iy] = imgradientxy(image1, 'prewitt'); 

% calculate gradient products
IxIx = Ix.*Ix;
IyIy = Iy.*Iy;
IxIy = Ix.*Iy;


% Sum in 3x3 window 
filter = ones(3,3); 
IxIx = imfilter(IxIx, filter, 'replicate'); 
IxIy = imfilter(IxIy, filter, 'replicate'); 
IyIy = imfilter(IyIy, filter, 'replicate'); 

% Compute C matrix and R matrix 
eigenvalues = {}; 
k = .06; 
Rs = zeros(size(Ix)); 
for i = 1:size(Ix,1)
    for j = 1:size(Ix,2)
        C = [IxIx(i,j) IxIy(i,j); IxIy(i,j) IyIy(i,j)]; 
        eigs = eig(double(C)); 
        R = eigs(1)*eigs(2) - (k * (eigs(1) + eigs(2))^2); 
        Rs(i,j) = R; 
    end 
end 
threshold = 10; 

%% Nonmax suppression 
% Calculate magnitude and direction of gradient 
[Imag, Idir] = imgradient(image1, 'prewitt');
directions = [-180, -135, -90, -45, 0, 45, 90, 135, 180];  
range = 3; 
for i = 1:size(Rs)
    for j = 1:size(Rs)
        if Rs(i,j) > threshold 
            % Find closest direction in magnitude of gradient 
            direction = min(abs(Rs(i,j) - directions)); 
            switch direction 
                case -180
                    for k = 1:range 
                        if 
        end 
    end 
end 


        


